(function(n){var i=function(){for(var t,i=["webkit","moz","ms"],r=document.createElement("div").style,u=("transform"in r)?"transform":undefined,n=0,f=i.length;n<f;n++)if(t=i[n]+"Transform",t in r){u=t;break}return u}(),e=function(t,r){if(t.item=this,this.element=t,t.tagName==="IMG"?(this.fullWidth=t.width,this.fullHeight=t.height):(t.style.display="inline-block",this.fullWidth=t.offsetWidth,this.fullHeight=t.offsetHeight),t.style.position="absolute",r.mirror&&this.element.tagName==="IMG"){this.reflection=n(t).reflect(r.mirror).next()[0];var u=n(this.reflection);this.reflection.fullHeight=u.height();u.css("margin-top",r.mirror.gap+"px");u.css("width","100%");t.style.width="100%";this.element=this.element.parentNode;this.element.item=this;this.element.alt=t.alt;this.element.title=t.title}i&&r.transforms&&(this.element.style[i+"Origin"]="0 0");this.moveTo=function(n,t,u){this.width=this.fullWidth*u;this.height=this.fullHeight*u;this.x=n;this.y=t;this.scale=u;var f=this.element.style;f.zIndex=""+u*100|0;i&&r.transforms?f[i]="translate("+n+"px, "+t+"px) scale("+u+")":(r.mirror&&this.element.tagName==="IMG"&&(this.reflection.style.marginTop=r.mirror.gap*u+"px"),f.width=this.width+"px",f.left=n+"px",f.top=t+"px")}},u=!window.performance||!window.performance.now?function(){return+new Date}:function(){return performance.now()},t=window.cancelAnimationFrame||window.cancelRequestAnimationFrame,r=window.requestAnimationFrame,f;(function(){for(var i=["webkit","moz","ms"],n=0,u=i.length;n<u&&!t;n++)t=window[i[n]+"CancelAnimationFrame"]||window[i[n]+"CancelRequestAnimationFrame"],r=r&&window[i[n]+"RequestAnimationFrame"]})();f=function(i,f){var o=this,s=n(i),h;this.items=[];this.xOrigin=f.xOrigin===null?s.width()*.5:f.xOrigin;this.yOrigin=f.yOrigin===null?s.height()*.1:f.yOrigin;this.xRadius=f.xRadius===null?s.width()/2.3:f.xRadius;this.yRadius=f.yRadius===null?s.height()/6:f.yRadius;this.farScale=f.farScale;this.rotation=this.destRotation=Math.PI/2;this.speed=f.speed;this.smooth=f.smooth;this.fps=f.fps;this.timer=0;this.autoPlayAmount=f.autoPlay;this.autoPlayDelay=f.autoPlayDelay;this.autoPlayTimer=0;this.frontItemClass=f.frontItemClass;this.onLoaded=f.onLoaded;this.onRendered=f.onRendered;this.onAnimationFinished=f.onAnimationFinished;this.itemOptions={transforms:f.transforms};f.mirror&&(this.itemOptions.mirror=n.extend({gap:2},f.mirror));s.css({position:"relative",overflow:"hidden"});this.renderItem=function(n,t){var i=this.items[n],u=Math.sin(t),f=this.farScale,r=f+(1-f)*(u+1)*.5;return i.moveTo(this.xOrigin+r*(Math.cos(t)*this.xRadius-i.fullWidth*.5),this.yOrigin+r*u*this.yRadius,r),i};this.render=function(){for(var i,r=this.items.length,f=2*Math.PI/r,u=this.rotation,e=this.nearestIndex(),t=0;t<r;t++)i=this.renderItem(t,u),t===e?n(i.element).addClass(this.frontItemClass):n(i.element).removeClass(this.frontItemClass),u+=f;if(typeof this.onRendered=="function")this.onRendered(this)};this.playFrame=function(){var n=o.destRotation-o.rotation,t=u(),i=(t-o.lastTime)*.002;o.lastTime=t;Math.abs(n)<.003?(o.rotation=o.destRotation,o.pause(),typeof o.onAnimationFinished=="function"&&o.onAnimationFinished()):(o.rotation=o.destRotation-n/(1+o.speed*i),o.scheduleNextFrame());o.render()};this.scheduleNextFrame=function(){this.lastTime=u();this.timer=this.smooth&&t?r(o.playFrame):setTimeout(o.playFrame,1e3/this.fps)};this.itemsRotated=function(){return this.items.length*(Math.PI/2-this.rotation)/(2*Math.PI)};this.floatIndex=function(){var t=this.items.length,n=this.itemsRotated()%t;return n<0?n+t:n};this.nearestIndex=function(){return Math.round(this.floatIndex())%this.items.length};this.nearestItem=function(){return this.items[this.nearestIndex()]};this.play=function(){this.timer===0&&this.scheduleNextFrame()};this.pause=function(){this.smooth&&t?t(this.timer):clearTimeout(this.timer);this.timer=0};this.go=function(n){this.destRotation+=2*Math.PI/this.items.length*n;this.play()};this.goTo=function(n){var i=this.items.length,t=n-this.floatIndex()%i;return 2*Math.abs(t)>i&&(t-=t>0?i:-i),this.destRotation=this.rotation,this.go(-t),t};this.deactivate=function(){this.pause();clearInterval(this.autoPlayTimer);f.buttonLeft&&f.buttonLeft.unbind("click");f.buttonRight&&f.buttonRight.unbind("click");s.unbind(".cloud9")};this.autoPlay=function(){this.autoPlayTimer=setInterval(function(){o.go(o.autoPlayAmount)},this.autoPlayDelay)};this.enableAutoPlay=function(){s.bind("mouseover.cloud9",function(){clearInterval(o.autoPlayTimer)});s.bind("mouseout.cloud9",function(){o.autoPlay()});this.autoPlay()};this.bindControls=function(){f.buttonLeft&&f.buttonLeft.bind("click",function(){return o.go(-1),!1});f.buttonRight&&f.buttonRight.bind("click",function(){return o.go(1),!1});f.mouseWheel&&s.bind("mousewheel.cloud9",function(n,t){return o.go(t>0?1:-1),!1});f.bringToFront&&s.bind("click.cloud9",function(t){var i=n(t.target).closest("."+f.itemClass),r;i.length!==0&&(r=o.goTo(o.items.indexOf(i[0].item)),Math.abs(r)>.5&&t.preventDefault())})};h=s.find("."+f.itemClass);this.finishInit=function(){for(var t,n=0;n<h.length;n++)if(t=h[n],t.tagName==="IMG"&&(t.width===undefined||t.complete!==undefined&&!t.complete))return;for(clearInterval(this.initTimer),n=0;n<h.length;n++)this.items.push(new e(h[n],this.itemOptions));if(s.bind("mousedown onselectstart",function(){return!1}),this.autoPlayAmount!==0&&this.enableAutoPlay(),this.bindControls(),this.render(),typeof this.onLoaded=="function")this.onLoaded(this)};this.initTimer=setInterval(function(){o.finishInit()},50)};n.fn.Cloud9Carousel=function(t){return this.each(function(){t=n.extend({xOrigin:null,yOrigin:null,xRadius:null,yRadius:null,farScale:.5,transforms:!0,smooth:!0,fps:30,speed:4,autoPlay:0,autoPlayDelay:4e3,bringToFront:!1,itemClass:"cloud9-item",frontItemClass:null,handle:"carousel"},t);n(this).data(t.handle,new f(this,t))})}})(window.jQuery||window.Zepto);